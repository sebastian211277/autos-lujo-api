<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci贸n</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-container { background: white; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #28a745; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
        .btn-logout { background: #dc3545; }
        .price-mxn { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1> Gesti贸n de Inventario</h1>
        <button class="btn-logout" onclick="logout()">Cerrar Sesi贸n</button>
    </div>

    <div class="form-container">
        <h3>Agregar Nuevo Auto</h3>
        <form id="carForm">
            <input type="text" id="make" placeholder="Marca (ej. Ferrari)" required>
            <input type="text" id="model" placeholder="Modelo (ej. 488 Spider)" required>
            <input type="number" id="year" placeholder="A帽o" required>
            <input type="number" id="price" placeholder="Precio en USD" required>
            <input type="number" id="horsepower" placeholder="Caballos de fuerza" required>
            <textarea id="description" placeholder="Descripci贸n"></textarea>
            <button type="submit">Guardar Auto</button>
        </form>
    </div>

    <div id="carsList">
        <p>Cargando autos...</p>
    </div>

    <script>
        // Verificar si hay sesi贸n iniciada
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/index.html'; // Si no hay token, fuera
        }

        // Cargar autos al iniciar
        async function loadCars() {
            try {
                const res = await fetch('/api/cars');
                const data = await res.json();
                
                const list = document.getElementById('carsList');
                list.innerHTML = ''; // Limpiar lista

                data.data.forEach(car => {
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `
                        <h3>${car.make} ${car.model} (${car.year})</h3>
                        <p>Precio USD: $${car.price.toLocaleString()}</p>
                        <p class="price-mxn">Precio MXN: $${car.priceMXN ? car.priceMXN.toLocaleString() : 'N/A'}</p>
                        <small>ID: ${car._id}</small>
                    `;
                    list.appendChild(div);
                });
            } catch (error) {
                console.error('Error cargando autos:', error);
            }
        }

        // Enviar nuevo auto
        document.getElementById('carForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newCar = {
                make: document.getElementById('make').value,
                model: document.getElementById('model').value,
                year: document.getElementById('year').value,
                price: document.getElementById('price').value,
                horsepower: document.getElementById('horsepower').value,
                description: document.getElementById('description').value
            };

            try {
                const res = await fetch('/api/cars', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-auth-token': token // Enviamos el token para autenticar
                    },
                    body: JSON.stringify(newCar)
                });

                if (res.ok) {
                    alert('Auto creado correctamente');
                    loadCars(); // Recargar la lista
                    e.target.reset(); // Limpiar formulario
                } else {
                    alert('Error al crear auto');
                }
            } catch (error) {
                console.error(error);
            }
        });

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/index.html';
        }

        loadCars();
    </script>
</body>
</html>