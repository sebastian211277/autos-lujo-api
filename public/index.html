<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autos Luxury - Catálogo Maestro</title>
    <style>
        body { font-family: 'Helvetica Neue', sans-serif; background-color: #0a0a0a; color: #fff; margin: 0; }
        
        /* Header */
        header { padding: 20px 40px; border-bottom: 1px solid #333; background: #000; position: sticky; top: 0; z-index: 100; }
        .header-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 20px; }
        h1 { color: #d4af37; text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; margin: 0; }
        
        .search-container { flex-grow: 1; max-width: 400px; }
        .search-input { 
            width: 100%; padding: 10px 20px; background: #1a1a1a; border: 1px solid #333; 
            border-radius: 25px; color: white; outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: #d4af37; }

        /* Grid & Cards */
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; min-height: 60vh; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .card { background: #1a1a1a; border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid #333; }
        .card:hover { transform: translateY(-5px); border-color: #d4af37; }
        .card img { width: 100%; height: 220px; object-fit: cover; }
        .card-info { padding: 15px; }
        .card-price { color: #d4af37; font-weight: bold; margin-top: 5px; }

        /* PAGINACIÓN */
        .pagination { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 50px 0; }
        .page-btn { 
            background: #1a1a1a; color: #d4af37; border: 1px solid #d4af37; padding: 10px 25px; 
            border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .page-btn:hover:not(:disabled) { background: #d4af37; color: black; }
        .page-btn:disabled { border-color: #333; color: #555; cursor: not-allowed; }
        #pageInfo { font-size: 0.9rem; letter-spacing: 1px; color: #888; }

        /* Modal (Mantenemos el estilo anterior) */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; }
        .modal-content { background: #151515; width: 90%; max-width: 900px; border-radius: 8px; overflow: hidden; display: flex; }
        @media (max-width: 768px) { .modal-content { flex-direction: column; } .header-container { flex-direction: column; text-align: center; } }
    </style>
</head>
<body>

    <header>
        <div class="header-container">
            <h1>Autos Luxury</h1>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar..." onkeyup="handleSearch()">
            </div>
            <a href="/login.html" style="color:#555; text-decoration:none; font-size:0.8rem;">Admin</a>
        </div>
    </header>

    <div class="container">
        <div id="grid" class="grid"></div>
        
        <div class="pagination">
            <button id="prevBtn" class="page-btn" onclick="changePage(-1)">Anterior</button>
            <span id="pageInfo">Página 1 de 1</span>
            <button id="nextBtn" class="page-btn" onclick="changePage(1)">Siguiente</button>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let totalPages = 1;
        const limit = 6; // Mostraremos 6 autos por página

        async function loadCars(page = 1) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '<p style="text-align:center; width:100%;">Cargando...</p>';

            try {
                // Llamamos a la API con los parámetros de paginación
                const res = await fetch(`/api/cars?page=${page}&limit=${limit}`);
                const response = await res.json();
                
                if (response.success) {
                    renderCars(response.data);
                    currentPage = response.currentPage;
                    totalPages = response.totalPages;
                    updatePaginationUI();
                }
            } catch (error) {
                grid.innerHTML = '<p style="color:red;">Error al cargar datos.</p>';
            }
        }

        function renderCars(cars) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            if (cars.length === 0) {
                grid.innerHTML = '<p style="text-align:center; width:100%;">No hay autos disponibles.</p>';
                return;
            }

            cars.forEach(car => {
                const cover = (car.images && car.images.length) ? car.images[0] : '';
                grid.innerHTML += `
                    <div class="card">
                        <img src="${cover}">
                        <div class="card-info">
                            <h3 class="card-title">${car.make} ${car.model}</h3>
                            <div class="card-price">US $${car.price.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            });
        }

        function updatePaginationUI() {
            document.getElementById('pageInfo').innerText = `Página ${currentPage} de ${totalPages}`;
            document.getElementById('prevBtn').disabled = (currentPage === 1);
            document.getElementById('nextBtn').disabled = (currentPage === totalPages);
        }

        function changePage(step) {
            const newPage = currentPage + step;
            if (newPage >= 1 && newPage <= totalPages) {
                loadCars(newPage);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Búsqueda (Nota: Para un buscador pro con paginación, 
        // normalmente filtrarías en el backend, pero aquí mantendremos la sencillez)
        function handleSearch() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            if (term === "") {
                loadCars(1); // Si borra la búsqueda, vuelve a la paginación normal
                return;
            }
            // Si hay término, cargamos todos y filtramos localmente 
            // (Para un proyecto real, el backend debería filtrar)
            fetch('/api/cars?limit=100').then(res => res.json()).then(response => {
                const filtered = response.data.filter(c => 
                    c.make.toLowerCase().includes(term) || c.model.toLowerCase().includes(term)
                );
                renderCars(filtered);
                document.getElementById('prevBtn').disabled = true;
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('pageInfo').innerText = "Resultados de búsqueda";
            });
        }

        loadCars(1);
    </script>
</body>
</html>