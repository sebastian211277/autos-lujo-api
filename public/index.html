<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autos Luxury - Cat치logo</title>
    <style>
        body { font-family: 'Helvetica Neue', sans-serif; background-color: #0a0a0a; color: #fff; margin: 0; }
        
        /* Header */
        header { padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        h1 { color: #d4af37; text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; margin: 0; }
        .admin-link { color: #555; text-decoration: none; font-size: 0.8rem; transition: 0.3s; }
        .admin-link:hover { color: #d4af37; }

        /* Grid */
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }

        /* Tarjetas */
        .card { background: #1a1a1a; border-radius: 8px; overflow: hidden; transition: transform 0.3s; cursor: pointer; border: 1px solid #333; }
        .card:hover { transform: translateY(-5px); border-color: #d4af37; }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-info { padding: 15px; }
        .card-title { margin: 0; font-size: 1.2rem; }
        .card-price { color: #d4af37; font-weight: bold; margin-top: 5px; }

        /* --- VENTANA MODAL (FICHA T칄CNICA) --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); justify-content: center; align-items: center; }
        
        /* Dise침o del Modal: Grid de 2 columnas */
        .modal-content { 
            background: #151515; width: 90%; max-width: 1000px; height: 80vh; 
            display: grid; grid-template-columns: 1.5fr 1fr; /* Izquierda Fotos, Derecha Info */
            border-radius: 8px; overflow: hidden; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); 
            position: relative;
        }

        /* Columna Izquierda: Galer칤a */
        .modal-gallery { position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
        .modal-img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        /* Botones de navegaci칩n galer칤a */
        .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 15px; cursor: pointer; font-size: 20px; }
        .prev { left: 10px; } .next { right: 10px; }
        .nav-btn:hover { background: #d4af37; color: black; }

        /* Columna Derecha: Informaci칩n */
        .modal-details { padding: 40px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .detail-title { font-size: 2rem; color: #d4af37; margin: 0; line-height: 1.2; }
        .detail-price { font-size: 1.5rem; color: #fff; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .specs-row { display: flex; gap: 20px; font-size: 0.9rem; color: #aaa; }
        .description { line-height: 1.6; color: #ccc; margin-top: 10px; white-space: pre-wrap; } /* Respeta los saltos de l칤nea */
        
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 30px; color: #fff; cursor: pointer; z-index: 1001; }

        /* Responsive para celular */
        @media (max-width: 768px) {
            .modal-content { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; height: 90vh; }
            .modal-gallery { height: 100%; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Autos Luxury</h1>
        <a href="/login.html" class="admin-link">Admin Access</a>
    </header>

    <div class="container">
        <div id="grid" class="grid">Cargando inventario...</div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            
            <div class="modal-gallery">
                <button class="nav-btn prev" onclick="moveSlide(-1)">&#10094;</button>
                <img id="modalImg" class="modal-img" src="" alt="Auto">
                <button class="nav-btn next" onclick="moveSlide(1)">&#10095;</button>
            </div>

            <div class="modal-details">
                <h2 id="mTitle" class="detail-title">Modelo</h2>
                <div class="detail-price">
                    <div id="mPriceUSD">USD $0</div>
                    <small id="mPriceMXN" style="font-size: 1rem; color: #888;">MXN $0</small>
                </div>
                
                <div class="specs-row">
                    <span>游늰 <span id="mYear">2024</span></span>
                    <span>游냁 <span id="mHP">500</span> HP</span>
                </div>

                <div class="description">
                    <h3>Descripci칩n</h3>
                    <p id="mDesc">...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCarImages = [];
        let curIndex = 0;

        async function loadCars() {
            const res = await fetch('/api/cars');
            const data = await res.json();
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            data.data.forEach(car => {
                // Truco para pasar el objeto completo al click
                // Reemplazamos comillas simples para evitar errores de JS
                const carJson = JSON.stringify(car).replace(/'/g, "&#39;");
                const cover = (car.images && car.images.length) ? car.images[0] : 'https://via.placeholder.com/400';

                grid.innerHTML += `
                    <div class="card" onclick='openModal(${carJson})'>
                        <img src="${cover}">
                        <div class="card-info">
                            <h3 class="card-title">${car.make} ${car.model}</h3>
                            <div class="card-price">US $${car.price.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            });
        }

        // --- L칍GICA DEL MODAL ---
        function openModal(car) {
            // 1. Llenar Textos
            document.getElementById('mTitle').innerText = `${car.make} ${car.model}`;
            document.getElementById('mPriceUSD').innerText = `US $${car.price.toLocaleString()}`;
            document.getElementById('mPriceMXN').innerText = `MXN $${(car.priceMXN || 0).toLocaleString()}`;
            document.getElementById('mYear').innerText = car.year;
            document.getElementById('mHP').innerText = car.horsepower;
            document.getElementById('mDesc').innerText = car.description || "Sin descripci칩n disponible.";

            // 2. Configurar Galer칤a
            currentCarImages = car.images && car.images.length ? car.images : ['https://via.placeholder.com/800?text=Sin+Foto'];
            curIndex = 0;
            updateImage();

            // 3. Mostrar
            document.getElementById('detailModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function moveSlide(step) {
            curIndex += step;
            if(curIndex >= currentCarImages.length) curIndex = 0;
            if(curIndex < 0) curIndex = currentCarImages.length - 1;
            updateImage();
        }

        function updateImage() {
            document.getElementById('modalImg').src = currentCarImages[curIndex];
        }

        // Cerrar con Escape
        window.onkeydown = function(e) { if(e.key === "Escape") closeModal(); }
        
        loadCars();
    </script>
</body>
</html>